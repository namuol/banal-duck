<html><head><meta charset="utf-8" /><title>Dual N-Back</title><link rel="stylesheet" href="style.css" /><script type="text/javascript" src="storage.min.js"></script><script type="text/javascript" src="jquery-1.7.2.min.js"></script><script type="text/javascript" src="soundmanager2.js"></script></head><body><div id="loading_wrapper"><table><tbody><tr><td id="loading">Please Wait...</td></tr></tbody></table></div><div id="results" style="display:none"><div id="instructions">How to play Dual 2-Back:<ul><li>Any time a grid square you saw 2 turns ago is highlighted again, press [A]</li><li>Any time a letter you heard 2 turns ago is spoken again, press [L]</li><li>It's possible for both of these cases to occur on the same turn</li><li>Don't be discouraged! You <strong>will</strong> improve with practice!</li></ul></div><div id="percent_wrapper"><table><tbody><tr><td id="percent"></td></tr></tbody></table></div><div id="start_game_msg">Press [SPACE] to start another round</div></div><div id="game" style="display:none"><table id="layout"><tr><td id="a_button">POSITION (A)</td><td id="grid_wrap"><div id="hud"><div id="type"></div><div id="remaining"></div></div><table id="grid"><tr><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td></tr></table></td><td id="b_button">LETTER (L)</td></tr></table></div><script>var __slice = Array.prototype.slice;var __hasProp = Object.prototype.hasOwnProperty;var __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };var __extends = function(child, parent) {  for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; }  function ctor() { this.constructor = child; }  ctor.prototype = parent.prototype; child.prototype = new ctor; child.__super__ = parent.prototype;  return child; };var __indexOf = Array.prototype.indexOf || function(item) {  for (var i = 0, l = this.length; i < l; i++) {    if (this[i] === item) return i;  } return -1; };(function () {
      /*
      */

      /*
      */
      return $(function() {
        var all_loaded, choose, frand, grid, rand, sounds_loaded, sounds_to_load;
        grid = $('#grid td');
        frand = function(min, max) {
          return min + Math.random() * (max - min);
        };
        rand = function(min, max) {
          return Math.round(frand(min, max));
        };
        choose = function(array) {
          return array[rand(0, array.length - 1)];
        };
        window.highlight = function(el, klass, delay, ttl) {
          if (klass == null) {
            klass = 'highlighted';
          }
          if (delay == null) {
            delay = 0;
          }
          if (ttl == null) {
            ttl = 500;
          }
          return setTimeout(function() {
            $(el).addClass(klass);
            return setTimeout(function() {
              return $(el).removeClass(klass);
            }, ttl);
          }, delay);
        };
        window.sounds = [];
        all_loaded = void 0;
        sounds_loaded = 0;
        sounds_to_load = [
          {
            id: 'c',
            url: 'c.wav',
            volume: 50
          }, {
            id: 'h',
            url: 'h.wav',
            volume: 50
          }, {
            id: 'k',
            url: 'k.wav',
            volume: 50
          }, {
            id: 'l',
            url: 'l.wav',
            volume: 50
          }, {
            id: 'q',
            url: 'q.wav',
            volume: 50
          }, {
            id: 'r',
            url: 'r.wav',
            volume: 50
          }, {
            id: 's',
            url: 's.wav',
            volume: 50
          }, {
            id: 't',
            url: 't.wav',
            volume: 50
          }
        ];
        soundManager.url = 'swf';
        soundManager.flashVersion = 9;
        soundManager.useHighPerformance = false;
        soundManager.useFastPolling = true;
        soundManager.useHTML5Audio = true;
        soundManager.preferFlash = false;
        soundManager.defaultOptions.onload = function() {
          if (++sounds_loaded === sounds_to_load.length) {
            return all_loaded();
          }
        };
        return soundManager.onready(function() {
          var dual_n_back, new_round, sound, _i, _len;
          soundManager.defaultOptions.autoLoad = true;
          for (_i = 0, _len = sounds_to_load.length; _i < _len; _i++) {
            sound = sounds_to_load[_i];
            sounds.push(soundManager.createSound(sound));
          }
          dual_n_back = function(n, count, turn_dur) {
            var a, a_match, a_matches, b, b_match, b_matches, current, generate_results, i, intvl, start, started, turns;
            if (turn_dur == null) {
              turn_dur = 3000;
            }
            started = false;
            turns = [];
            a_match = b_match = false;
            current = 0;
            i = 0;
            while (i < count) {
              a = rand(0, grid.length - 1);
              b = rand(0, sounds.length - 1);
              turns.push({
                a: a,
                b: b,
                a_pressed: false,
                b_pressed: false
              });
              if ((i >= n) && (Math.random() > 0.15)) {
                turns[i - n].a = a;
              }
              if ((i >= n) && (Math.random() > 0.15)) {
                turns[i - n].b = b;
              }
              ++i;
            }
            $('#type').html("Dual " + n + "-Back");
            start = void 0;
            a_matches = function(num) {
              if (num < n) {
                return false;
              }
              return turns[num].a === turns[num - n].a;
            };
            b_matches = function(num) {
              if (num < n) {
                return false;
              }
              return turns[num].b === turns[num - n].b;
            };
            generate_results = function() {
              var a_correct, a_incorrect, a_missed, b_correct, b_incorrect, b_missed, curr;
              a_correct = b_correct = 0;
              a_incorrect = b_incorrect = 0;
              a_missed = b_missed = 0;
              a_match = b_match = false;
              i = 0;
              while (i < turns.length) {
                a_match = b_match = false;
                curr = turns[i];
                a_match = a_matches(i);
                b_match = b_matches(i);
                if (a_match) {
                  if (curr.a_pressed) {
                    ++a_correct;
                  } else {
                    ++a_missed;
                  }
                } else if (curr.a_pressed) {
                  ++a_incorrect;
                }
                if (b_match) {
                  if (curr.b_pressed) {
                    ++b_correct;
                  } else {
                    ++b_missed;
                  }
                } else if (curr.b_pressed) {
                  ++b_incorrect;
                }
                ++i;
              }
              return {
                a_correct: a_correct,
                b_correct: b_correct,
                a_incorrect: a_incorrect,
                b_incorrect: b_incorrect,
                a_missed: a_missed,
                b_missed: b_missed
              };
            };
            intvl = 0;
            start = function(done) {
              started = true;
              current = 0;
              return intvl = setInterval(function() {
                if (current >= count) {
                  clearInterval(intvl);
                  done(generate_results());
                  return;
                }
                $('#type').html("Dual " + n + "-Back");
                $('#remaining').html("" + (current + 1) + " of " + count);
                highlight(grid[turns[current].a]);
                sounds[turns[current].b].play();
                return ++current;
              }, turn_dur);
            };
            return {
              n: n,
              count: count,
              turns: turns,
              turn_dur: turn_dur,
              a_pressed: function() {
                if (!turns[current - 1].a_pressed) {
                  if (a_matches(current - 1)) {
                    highlight($('#a_button'), 'success', 0, 250);
                  } else {
                    highlight($('#a_button'), 'failure', 0, 250);
                  }
                  return turns[current - 1].a_pressed = true;
                }
              },
              b_pressed: function() {
                if (!turns[current - 1].b_pressed) {
                  if (b_matches(current - 1)) {
                    highlight($('#b_button'), 'success', 0, 250);
                  } else {
                    highlight($('#b_button'), 'failure', 0, 250);
                  }
                  return turns[current - 1].b_pressed = true;
                }
              },
              start: function(done) {
                if (done == null) {
                  done = new Function;
                }
                return start(done);
              },
              stop: function() {
                if (intvl) {
                  return clearInterval(intvl);
                }
              }
            };
          };
          new_round = function() {
            if (!(window.round != null)) {
              window.round = dual_n_back(2, 24, 3000);
              $('#results').hide();
              return round.start(function(r) {
                var cor, cssclass, msg, percent, tot;
                window.round = void 0;
                console.log(r);
                tot = r.a_missed + r.b_missed + r.a_correct + r.b_correct;
                cor = r.a_correct + r.b_correct - r.a_incorrect - r.b_incorrect;
                console.log(tot);
                console.log(cor);
                percent = Math.round(100 * (cor / tot));
                if (percent <= 50) {
                  cssclass = 'bad';
                  msg = choose(['don\'t be discouraged!', 'give it another try!']);
                } else if (percent <= 80) {
                  cssclass = 'better';
                  msg = choose(['not bad.', 'you\'re getting there!', 'keep it up!']);
                } else {
                  cssclass = 'excellent';
                  msg = choose(['excellent!', 'now you\'ve got it!', 'bravo!', '*high fives*', 'is this too easy for you?']);
                }
                $('#percent').html("" + percent + "% correct<br>" + msg);
                $('#percent').removeClass('bad');
                $('#percent').removeClass('better');
                $('#percent').removeClass('excellent');
                $('#percent').addClass(cssclass);
                return $('#results').show();
              });
            }
          };
          return all_loaded = function() {
            $('#loading_wrapper').hide();
            $('#results').show();
            $('#game').show();
            $(window).keydown(function(e) {
              switch (e.which) {
                case 65:
                  if (!window.round) {
                    return true;
                  }
                  return round.a_pressed();
                case 76:
                  if (!window.round) {
                    return true;
                  }
                  return round.b_pressed();
                case 32:
                  return new_round();
              }
            });
            $(window).on('click', '#percent_wrapper', function() {
              return new_round();
            });
            $(window).on('click', '#a_button', function() {
              if (!window.round) {
                return true;
              }
              return round.a_pressed();
            });
            return $(window).on('click', '#b_button', function() {
              if (!window.round) {
                return true;
              }
              return round.b_pressed();
            });
          };
        });
      });
    }).call(this);</script></body></html>